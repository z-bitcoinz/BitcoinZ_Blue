name: Create Release

on:
  push:
    tags:
      - 'v*'  # Trigger on version tags like v1.0.0

jobs:
  # Build all platforms first
  build-all:
    uses: ./.github/workflows/build-and-sign.yml

  # Create release after builds complete
  create-release:
    needs: build-all
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          merge-multiple: true

      - name: List downloaded artifacts
        run: |
          echo "üì¶ Downloaded artifacts:"
          find . -name "*.zip" -o -name "*.exe" -o -name "*.AppImage" -o -name "*.deb" | sort

      - name: Create Release
        id: create_release
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref_name }}
          name: BitcoinZ Blue ${{ github.ref_name }} - Cross-Platform Release
          body: |
            # üéâ BitcoinZ Blue ${{ github.ref_name }} - Complete Cross-Platform Release

            ## ‚úÖ What's New

            ### üöÄ **Complete Cross-Platform Support**
            - **Windows**: Setup installer + portable ZIP
            - **macOS**: Universal app (Intel + Apple Silicon)
            - **Linux**: AppImage + DEB package

            ### üíé **BitcoinZ Features**
            - Full BitcoinZ blockchain support
            - Native Rust performance optimizations
            - Secure wallet functionality
            - Transaction management
            - Address book integration
            - Modern UI with blue gradient theme

            ### üîß **Technical Achievements**
            - Rust 1.81 native modules for maximum performance
            - Node.js 17 compatibility
            - Automated build pipeline
            - Security scanning integration
            - Code signing for all platforms

            ## üì¶ **Download Options** ‚¨áÔ∏è

            ### ü™ü **Windows (x64)**
            - **Setup Installer** - `BitcoinZ Blue Setup *.exe` (Recommended)
            - **Portable Version** - `BitcoinZ Blue-*-win.zip` (No installation required)

            ### üçé **macOS**
            - **Apple Silicon (M1/M2/M3)** - `BitcoinZ Blue-*-arm64-mac.zip`
            - **Intel CPUs** - `BitcoinZ Blue-*-x64-mac.zip`

            ### üêß **Linux**
            - **Universal AppImage** - `BitcoinZ Blue-*.AppImage` (Recommended)
            - **Debian/Ubuntu Package** - `bitcoinz-wallet-lite_*_amd64.deb`

            ## üîí **Security**
            - All applications are code-signed
            - Automated vulnerability scanning
            - Secure build environment
            - Open source and auditable

            ## üõ† **Installation**

            ### Windows
            1. Download the setup.exe file
            2. Run the installer
            3. Follow the setup wizard

            ### macOS
            1. Download the appropriate ZIP for your CPU
            2. Extract and move to Applications folder
            3. Right-click and "Open" to bypass Gatekeeper

            ### Linux
            1. Download the .AppImage file
            2. Make executable: `chmod +x BitcoinZ\ Blue-*.AppImage`
            3. Run: `./BitcoinZ\ Blue-*.AppImage`

            ---

            **Built with ‚ù§Ô∏è for the BitcoinZ community**

            **Auto-generated from successful builds**
          files: |
            **/*artifacts*/**
          draft: false
          prerelease: false
